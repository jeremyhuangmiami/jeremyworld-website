<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.amplitude.com/libs/analytics-browser-2.11.1-min.js.gz"></script><script src="https://cdn.amplitude.com/libs/plugin-session-replay-browser-1.8.0-min.js.gz"></script><script>window.amplitude.add(window.sessionReplay.plugin({sampleRate: 1}));window.amplitude.init('97f3728a2fd64313884b262d4d2a4cd', {"autocapture":{"elementInteractions":true}});</script>
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "tidz5x6kwe");
</script>
  <!-- Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L4156EV21N"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-L4156EV21N');
  </script>
    <!-- Paste this right before your closing </head> tag -->
<script type="text/javascript">
  (function(e,c){if(!c.__SV){var l,h;window.mixpanel=c;c._i=[];c.init=function(q,r,f){function t(d,a){var g=a.split(".");2==g.length&&(d=d[g[0]],a=g[1]);d[a]=function(){d.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";b.people=b.people||[];b.toString=function(d){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);d||(a+=" (stub)");return a};b.people.toString=function(){return b.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders start_session_recording stop_session_recording people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
  for(h=0;h<l.length;h++)t(b,l[h]);var n="set set_once union unset remove delete".split(" ");b.get_group=function(){function d(p){a[p]=function(){b.push([g,[p].concat(Array.prototype.slice.call(arguments,0))])}}for(var a={},g=["get_group"].concat(Array.prototype.slice.call(arguments,0)),m=0;m<n.length;m++)d(n[m]);return a};c._i.push([q,r,f])};c.__SV=1.2;var k=e.createElement("script");k.type="text/javascript";k.async=!0;k.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===
  e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=e.getElementsByTagName("script")[0];e.parentNode.insertBefore(k,e)}})(document,window.mixpanel||[])
  
  mixpanel.init('402c44875e3035ddcf05a9ba7a5904f7', {
    autocapture: true,
    record_sessions_percent: 100,
  })

</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Persistent Whiteboard</title>
<style>
:root{
  --bg:#f8fafc;
  --toolbar-bg:rgba(255,255,255,0.85);
  --border:#e6e9ee;
  --shadow:0 6px 18px rgba(20,20,40,0.06);
  --primary:#2563eb;
  --muted:#475569;
}
body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);height:100%;display:flex;flex-direction:column;}
header{position:sticky;top:0;z-index:20;display:flex;gap:8px;align-items:center;padding:10px 14px;background:var(--toolbar-bg);border-bottom:1px solid var(--border);box-shadow:var(--shadow);backdrop-filter:blur(6px);}
.tool, select, input[type="range"]{border:1px solid var(--border);background:white;border-radius:8px;padding:6px 8px;box-shadow: 0 2px 8px rgba(16,24,40,0.03); font-size:14px;}
.icon-btn{display:inline-flex;align-items:center;justify-content:center;height:36px;min-width:36px;border-radius:8px;border:1px solid var(--border);background:white;cursor:pointer;}
.primary{background:var(--primary);color:white;border:none;}
.small-muted{font-size:13px;color:var(--muted);}
#board{display:block;width:100%;box-sizing:border-box;background:white;touch-action:none;cursor:crosshair;margin:0;border-top:1px solid #f1f5f9;}
.text-box{position:absolute;background:rgba(255,255,255,0.9);border:1px solid var(--border);padding:4px 6px;border-radius:4px;font-size:16px;resize:none;overflow:hidden;outline:none;}
</style>
</head>
<body>
<header>
<select id="tool" class="tool" title="Tool">
<option value="pencil">‚úèÔ∏è Pencil</option>
<option value="marker">üñäÔ∏è Marker</option>
<option value="eraser">üßΩ Eraser</option>
<option value="line">üìè Line</option>
<option value="rect">‚ñ≠ Rectangle</option>
<option value="circle">‚ö™ Circle</option>
<option value="text">üî§ Text</option>
</select>
<input id="color" type="color" value="#1f2937" title="Color" class="icon-btn" style="padding:0;border-radius:8px;height:36px;width:44px" />
<label class="small-muted">Size</label>
<input id="size" type="range" min="1" max="48" value="4" class="tool" style="width:140px;" />
<label class="small-muted">Opacity</label>
<input id="opacity" type="range" min="0.05" max="1" step="0.01" value="1" class="tool" style="width:140px;" />
<button class="icon-btn" onclick="undo()" title="Undo">‚Ü∂</button>
<button class="icon-btn" onclick="redo()" title="Redo">‚Ü∑</button>
<button class="icon-btn" onclick="clearBoard()" title="Clear">üßπ</button>
<button class="icon-btn" onclick="exportPNG()" title="Export as PNG">üíæ</button>
</header>
<div style="position:relative; flex:1;">
<canvas id="board"></canvas>
</div>

<script>
const canvas=document.getElementById('board');
const ctx=canvas.getContext('2d');

let tool=document.getElementById('tool').value;
let color=document.getElementById('color').value;
let size=Number(document.getElementById('size').value);
let opacity=Number(document.getElementById('opacity').value);

let history=[],historyIndex=-1;

let canvasWidth=window.innerWidth;
let canvasHeight=Math.max(window.innerHeight - document.querySelector('header').offsetHeight,800);

let isDrawing=false,startX=0,startY=0;

function setCanvasSize(w,h,preserve=true){
  return new Promise(resolve=>{
    const prevData=preserve?canvas.toDataURL():null;
    canvas.style.width=w+'px';
    canvas.style.height=h+'px';
    canvas.width=Math.round(w);
    canvas.height=Math.round(h);
    ctx.setTransform(1,0,0,1,0,0);
    if(preserve && prevData){
      const img=new Image();
      img.onload=()=>{ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0,img.width,img.height);resolve();};
      img.src=prevData;
    } else {ctx.clearRect(0,0,canvas.width,canvas.height);resolve();}
  });
}

// Load saved canvas
function loadFromLocal(){
  const data=localStorage.getItem('whiteboard');
  if(data){const img=new Image();img.onload=()=>ctx.drawImage(img,0,0,img.width,img.height);img.src=data;}
}
setCanvasSize(canvasWidth,canvasHeight,false).then(()=>{pushHistory();loadFromLocal();});

window.addEventListener('resize',()=>{canvasWidth=window.innerWidth;setCanvasSize(canvasWidth,canvasHeight,true);});

function pushHistory(){
  const data=canvas.toDataURL();
  if(historyIndex>=0 && history[historyIndex] && history[historyIndex].data===data) return;
  history=history.slice(0,historyIndex+1);
  history.push({data,width:canvas.width,height:canvas.height});
  historyIndex=history.length-1;
  // save to localStorage
  localStorage.setItem('whiteboard',data);
}
function undo(){if(historyIndex<=0)return;historyIndex--;restoreState(history[historyIndex]);}
function redo(){if(historyIndex>=history.length-1)return;historyIndex++;restoreState(history[historyIndex]);}
function restoreState(state){
  setCanvasSize(state.width,state.height,false).then(()=>{
    const img=new Image();
    img.onload=()=>{ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0);};
    img.src=state.data;
  });
}

function applySettings(){
  if(tool==='eraser'){ctx.globalCompositeOperation='destination-out';ctx.globalAlpha=1;ctx.lineWidth=Math.max(8,size*2);}
  else{ctx.globalCompositeOperation='source-over';ctx.globalAlpha=opacity;ctx.lineWidth=size;}
  ctx.lineCap='round';ctx.lineJoin='round';ctx.strokeStyle=color;ctx.fillStyle=color;
}

function getCoords(e){
  const rect=canvas.getBoundingClientRect();
  if(e.touches && e.touches.length)return{x:e.touches[0].clientX-rect.left,y:e.touches[0].clientY-rect.top};
  if(e.changedTouches && e.changedTouches.length)return{x:e.changedTouches[0].clientX-rect.left,y:e.changedTouches[0].clientY-rect.top};
 
